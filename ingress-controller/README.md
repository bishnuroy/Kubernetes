

My Old Document : https://github.com/bishnuroy/Kubernetes/tree/master/centos/Ingress%20controller

Public Ingress Controller Git Document:

https://github.com/nginxinc/kubernetes-ingress/tree/v1.10.0/deployments (This repo not having Default-Backend Service)

Thested with This repo and its working fine.

https://github.com/kubernetes/ingress-nginx/tree/ingress-nginx-3.15.2/charts/ingress-nginx/templates


To Setup Ingress Controller you need to follow following Steps:  You need HELM to install this Igress Controller.

**Step1:**
 - Do git clone in your local system
   - git clone https://github.com/nginxinc/kubernetes-ingress.git
 - Go to helm-chart folder 
   - "cd kubernetes-ingress/deployments/helm-chart/"
   
**Step2:** edit "values.yaml" file as per your needs.

```
rbac:
  ## Configures RBAC if you using RBAC in your cluster make it true
  create: true
```
  - Use daemonset (Bater to have daemonset) 
```
controller:
  ## The name of the Ingress controller daemonset or deployment.
  ## Autogenerated if not set or set to "".
  # name: nginx-ingress

  ## The kind of the Ingress controller installation - deployment or daemonset.
  #kind: deployment
  kind: daemonset
```
  - Give the secret name (Will update Cert-Manager document with it you can issue self-signe of CA cert for your ingress.)
```
defaultTLS:
    ## The base64-encoded TLS certificate for the default HTTPS server. If not specified, a pre-generated self-signed certificate is used.
    ## Note: It is recommended that you specify your own certificate.
    cert: ""
    ## The base64-encoded TLS key for the default HTTPS server. Note: If not specified, a pre-generated key is used.
    ## Note: It is recommended that you specify your own key.
    key: "" 
    ## The secret with a TLS certificate and key for the default HTTPS server.
    ## The value must follow the following format: `<namespace>/<name>`.
    ## Used as an alternative to specifying a certificate and key using `controller.defaultTLS.cert` and `controller.defaultTLS.key` parameters.
    ## Format: <namespace>/<secret_name>
    secret: ingress-nginx/nginx-ingress-tls

  wildcardTLS:
    ## The base64-encoded TLS certificate for every Ingress host that has TLS enabled but no secret specified.
    ## If the parameter is not set, for such Ingress hosts NGINX will break any attempt to establish a TLS connection.
    cert: ""

    ## The base64-encoded TLS key for every Ingress host that has TLS enabled but no secret specified.
    ## If the parameter is not set, for such Ingress hosts NGINX will break any attempt to establish a TLS connection.
    key: ""

    ## The secret with a TLS certificate and key for every Ingress host that has TLS enabled but no secret specified.
    ## The value must follow the following format: `<namespace>/<name>`.
    ## Used as an alternative to specifying a certificate and key using `controller.wildcardTLS.cert` and `controller.wildcardTLS.key` parameters.
    ## Format: <namespace>/<secret_name>
    secret: ingress-nginx/nginx-ingress-tls
```

  - Use Service type LoadBalancer (If you integrated MetalLB the you can specify LB IP also). Ref:- https://github.com/bishnuroy/Kubernetes/blob/master/k8s_ha_setup/MetalLB.MD
  ```
    service:
    ## Creates a service to expose the Ingress controller pods.
    create: true

    ## The type of service to create for the Ingress controller.
    type: LoadBalancer
  ```
  ```
      ## The static IP address for the load balancer. Requires controller.service.type set to LoadBalancer. The cloud provider must support this feature.
    loadBalancerIP: "LB_IP"
  ```

**Step3:**

  - helm install nginx-ingress kubernetes-ingress/deployments/helm-chart  --namespace ingress-nginx --set controller.metrics.enabled=true --kubeconfig=brk8s01-admin.conf
  -  helm ls -n ingress-nginx --kubeconfig=brk8s01-admin.conf
```
Bishnus-MacBook-Pro-2:brk8s bishnuroy$ helm ls -n ingress-nginx --kubeconfig=brk8s01-admin.conf
NAME         	NAMESPACE    	REVISION	UPDATED                            	STATUS  	CHART             	APP VERSION
nginx-ingress	ingress-nginx	1       	2021-02-07 23:12:46.62882 +0530 IST	deployed	nginx-ingress-edge	edge       
Bishnus-MacBook-Pro-2:brk8s bishnuroy$
```
```
Bishnus-MacBook-Pro-2:brk8s bishnuroy$ kubectl  --kubeconfig=brk8s01-admin.conf  -n ingress-nginx get pods
NAME                                READY   STATUS    RESTARTS   AGE
nginx-ingress-nginx-ingress-dmtff   1/1     Running   0          39h
nginx-ingress-nginx-ingress-kdcbp   1/1     Running   0          39h
nginx-ingress-nginx-ingress-t647c   1/1     Running   0          39h
Bishnus-MacBook-Pro-2:brk8s bishnuroy$ 
Bishnus-MacBook-Pro-2:brk8s bishnuroy$ kubectl  --kubeconfig=brk8s01-admin.conf  -n ingress-nginx get svc
NAME                          TYPE           CLUSTER-IP    EXTERNAL-IP   PORT(S)                      AGE
nginx-ingress-nginx-ingress   LoadBalancer   10.96.87.82   Load_Balancer_IP   80:30970/TCP,443:32218/TCP   39h
Bishnus-MacBook-Pro-2:brk8s bishnuroy$ 
```

**Step4**

- Load_Balancer_IP should be mapped in DNS with your wildcard expose url.
  - like *.brrnd.example.com
